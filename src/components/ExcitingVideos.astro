---
// Importar todas las imágenes
import image1 from "../img/ContigoSoy.png";
import image2 from "../img/LoQueNoTeDije.png";
import image3 from "../img/MadreEterna.png";
import image4 from "../img/NoticiaBendita.png";

const videos = [
  {
    title: "Reacción Cumpleaños",
    desc: "La emoción de recibir una canción única",
    src: "https://maquila.nyc3.cdn.digitaloceanspaces.com/Requerimiento/video/ADS15BODAEVENTOS.mp4",
    poster: "https://maquila.nyc3.cdn.digitaloceanspaces.com/Requerimiento/img/ContigoSoy.png"
  },
  {
    title: "Aniversario Especial",
    desc: "Amor en cada nota",
    src: "https://maquila.nyc3.cdn.digitaloceanspaces.com/Requerimiento/video/ADSGORDITA.mp4",
    poster: "https://maquila.nyc3.cdn.digitaloceanspaces.com/Requerimiento/img/LoQueNoTeDije.png"
  },
  {
    title: "Canción para la Abuelita",
    desc: "Ternura y emoción",
    src: "https://maquila.nyc3.cdn.digitaloceanspaces.com/Requerimiento/video/ADSABUELITA.mp4",
    poster: "https://maquila.nyc3.cdn.digitaloceanspaces.com/Requerimiento/img/MadreEterna.png"
  },
  {
    title: "Para Mi Gordita",
    desc: "Una sorpresa romántica",
    src: "https://maquila.nyc3.cdn.digitaloceanspaces.com/Requerimiento/video/ADSGORDITA.mp4",
    poster:"https://maquila.nyc3.cdn.digitaloceanspaces.com/Requerimiento/img/NoticiaBendita.png"
  }
];
---

<div class="rounded-3xl p-8 md:p-12 border-2 border-[#11676a]/20 shadow-xl relative overflow-hidden">
  <!-- Encabezado -->
  <div class="text-center mb-12">
    <div class="inline-flex items-center gap-2 bg-gradient-to-r from-[#11676a] to-[#2d8c89] text-white px-8 py-3 rounded-full text-base font-bold mb-4 shadow-2xl animate-pulse">
      <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-play h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <polygon points="6 3 20 12 6 21 6 3"></polygon>
      </svg>
      <span>Únete a quienes ya cantan su historia</span>
    </div>
    <h3 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Mira La Magia En Acción</h3>
    <p class="text-lg text-gray-600 max-w-2xl mx-auto">
      Descubre cómo nuestras canciones personalizadas crean momentos inolvidables
    </p>
  </div>

  <!-- Grid Desktop -->
  <div class="hidden md:grid md:grid-cols-4 gap-1 mb-8">
    {videos.map((video, index) => (
      <div
        class="video-container relative rounded-2xl overflow-hidden shadow-2xl group cursor-pointer border-2 border-[#11676a]/20 hover:border-[#11676a] transition-all hover:scale-[1.02]"
        style="aspect-ratio: 9 / 16;"
        data-video-src={video.src}
        data-index={index}
      >
        <!-- Poster como imagen de fondo -->
        <img 
          src={video.poster}
          alt={video.title}
          class="video-poster absolute inset-0 w-full h-full object-cover "
          loading="lazy"
        />

        <!-- Video (se crea dinámicamente solo cuando se necesita) -->
        <div class="video-placeholder absolute inset-0 w-full h-full " style="display: none;"></div>

        <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent flex items-end p-4 pointer-events-none ">
          <div class="text-white">
            <h4 class="text-lg font-bold mb-1">{video.title}</h4>
            <p class="text-xs opacity-90">{video.desc}</p>
          </div>
        </div>

        <!-- Botón de play -->
        <div class="play-button absolute inset-0 flex items-center justify-center pointer-events-none transition-opacity duration-300">
          <div class="w-16 h-16 rounded-full bg-white/90 flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-[#11676a] ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <polygon points="6 3 20 12 6 21 6 3"></polygon>
            </svg>
          </div>
        </div>
      </div>
    ))}
  </div>

  <!-- Carrusel Mobile -->
  <div class="md:hidden overflow-x-auto snap-x snap-mandatory scrollbar-hide -mx-4 px-4">
    <div class="flex gap-1 pb-4">
      {videos.map((video, index) => (
        <div
          class="video-container flex-shrink-0 w-[70vw] snap-center relative rounded-2xl overflow-hidden shadow-2xl group cursor-pointer border-2 border-[#11676a]/20"
          style="aspect-ratio: 9 / 16;"
          data-video-src={video.src}
          data-index={index}
        >
          <!-- Poster como imagen de fondo -->
          <img 
            src={video.poster}
            alt={video.title}
            class="video-poster absolute inset-0 w-full h-full object-cover "
            loading="lazy"
          />

          <!-- Video (se crea dinámicamente solo cuando se necesita) -->
          <div class="video-placeholder absolute inset-0 w-full h-full " style="display: none;"></div>

          <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent flex items-end p-6 pointer-events-none ">
            <div class="text-white">
              <h4 class="text-xl font-bold mb-2">{video.title}</h4>
              <p class="text-sm opacity-90">{video.desc}</p>
            </div>
          </div>

          <!-- Botón de play -->
          <div class="play-button absolute inset-0 flex items-center justify-center pointer-events-none transition-opacity duration-300">
            <div class="w-16 h-16 rounded-full bg-white/90 flex items-center justify-center shadow-lg">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-[#11676a] ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <polygon points="6 3 20 12 6 21 6 3"></polygon>
              </svg>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</div>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    const videoContainers = document.querySelectorAll('.video-container');
    
    videoContainers.forEach(container => {
      const poster = container.querySelector('.video-poster');
      const playButton = container.querySelector('.play-button');
      const placeholder = container.querySelector('.video-placeholder');
      const videoSrc = container.getAttribute('data-video-src');
      
      let video = null;
      let isPlaying = false;
      let isLoading = false;
      
      container.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        if (!video && !isLoading) {
          // Primera vez: crear y cargar el video
          isLoading = true;
          
          // Crear elemento video dinámicamente
          video = document.createElement('video');
          video.className = 'lazy-video absolute inset-0 w-full h-full object-cover ';
          video.loop = true;
          video.muted = true;
          video.playsInline = true;
          video.preload = 'auto';
          video.style.display = 'none';
          
          const source = document.createElement('source');
          source.src = videoSrc;
          source.type = 'video/mp4';
          
          video.appendChild(source);
          placeholder.appendChild(video);
          
          // Esperar a que el video esté listo
          video.addEventListener('canplay', function() {
            isLoading = false;
            playVideo();
          }, { once: true });
          
          // Manejar error de carga
          video.addEventListener('error', function() {
            isLoading = false;
            console.error('Error al cargar el video');
            alert('Error al cargar el video. Por favor intenta de nuevo.');
          }, { once: true });
          
          video.load();
          
        } else if (video && !isLoading) {
          // Video ya cargado: toggle play/pause
          if (!isPlaying) {
            playVideo();
          } else {
            pauseVideo();
          }
        }
      });
      
      function playVideo() {
        if (!video) return;
        
        // Ocultar poster
        poster.style.opacity = '0';
        poster.style.transition = 'opacity 0.3s ease';
        
        setTimeout(() => {
          poster.style.display = 'none';
          video.style.display = 'block';
          placeholder.style.display = 'block';
          
          video.play().then(() => {
            isPlaying = true;
            playButton.style.opacity = '0';
          }).catch(err => {
            console.error('Error al reproducir:', err);
            poster.style.display = 'block';
            poster.style.opacity = '1';
          });
        }, 300);
      }
      
      function pauseVideo() {
        if (!video) return;
        
        video.pause();
        video.style.display = 'none';
        placeholder.style.display = 'none';
        
        poster.style.display = 'block';
        setTimeout(() => {
          poster.style.opacity = '1';
        }, 10);
        
        playButton.style.opacity = '1';
        isPlaying = false;
      }
      
      // Pausar cuando sale de la vista
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (!entry.isIntersecting && isPlaying && video) {
            pauseVideo();
          }
        });
      }, { threshold: 0.3 });
      
      observer.observe(container);
    });
  });
</script>

<style>
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .video-poster {
    transition: opacity 0.3s ease;
  }

  .play-button {
    transition: opacity 0.3s ease;
  }
</style>